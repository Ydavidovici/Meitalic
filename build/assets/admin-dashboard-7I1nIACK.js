import{m as n}from"./module.esm-Bu3NRNwv.js";/* empty css              *//* empty css                *//* empty css                  */var w="basil",E=function(t){return t===3?"v3":t},v="https://js.stripe.com",b="".concat(v,"/").concat(w,"/stripe.js"),T=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,j=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/;var O=function(t){return T.test(t)||j.test(t)},R=function(){for(var t=document.querySelectorAll('script[src^="'.concat(v,'"]')),r=0;r<t.length;r++){var i=t[r];if(O(i.src))return i}return null},f=function(t){var r="",i=document.createElement("script");i.src="".concat(b).concat(r);var o=document.head||document.body;if(!o)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return o.appendChild(i),i},F=function(t,r){!t||!t._registerWrapper||t._registerWrapper({name:"stripe-js",version:"7.3.0",startTime:r})},l=null,h=null,u=null,C=function(t){return function(r){t(new Error("Failed to load Stripe.js",{cause:r}))}},k=function(t,r){return function(){window.Stripe?t(window.Stripe):r(new Error("Stripe.js not available"))}},q=function(t){return l!==null?l:(l=new Promise(function(r,i){if(typeof window>"u"||typeof document>"u"){r(null);return}if(window.Stripe){r(window.Stripe);return}try{var o=R();if(!(o&&t)){if(!o)o=f(t);else if(o&&u!==null&&h!==null){var a;o.removeEventListener("load",u),o.removeEventListener("error",h),(a=o.parentNode)===null||a===void 0||a.removeChild(o),o=f(t)}}u=k(r,i),h=C(i),o.addEventListener("load",u),o.addEventListener("error",h)}catch(s){i(s);return}}),l.catch(function(r){return l=null,Promise.reject(r)}))},P=function(t,r,i){if(t===null)return null;var o=r[0],a=o.match(/^pk_test/),s=E(t.version),c=w;a&&s!==c&&console.warn("Stripe.js@".concat(s," was loaded on the page, but @stripe/stripe-js@").concat("7.3.0"," expected Stripe.js@").concat(c,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var d=t.apply(void 0,r);return F(d,i),d},p,y=!1,S=function(){return p||(p=q(null).catch(function(t){return p=null,Promise.reject(t)}),p)};Promise.resolve().then(function(){return S()}).catch(function(e){y||console.warn(e)});var A=function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];y=!0;var o=Date.now();return S().then(function(a){return P(a,r,o)})};window.Alpine=n;n.store("auth",{isAuthenticated:window.isAuthenticated});n.store("dashboard",{devMetricsVisible:!1,activeModal:null,toggleDevMetrics(){this.devMetricsVisible=!this.devMetricsVisible},openModal(e){this.activeModal=e,window.dispatchEvent(new CustomEvent("open-modal",{detail:e}))},closeModal(e){this.activeModal===e&&(this.activeModal=null,window.dispatchEvent(new CustomEvent("close-modal",{detail:e})))}});function g(){return{devMetricsVisible:n.store("dashboard").devMetricsVisible,selectedOrders:[],selectedReview:{},selectedOrder:null,openModal(e){console.log("want to open modal:",e),n.store("dashboard").openModal(e)},closeModal(e){n.store("dashboard").closeModal(e)},singleMark(e,t){fetch(`/admin/orders/${e}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({status:t})}).then(r=>{if(!r.ok)throw new Error("Update failed");location.reload()}).catch(r=>{console.error(r),alert("Failed to update order status")})},markBulk(e){this.selectedOrders.length&&fetch("/admin/orders/bulk-update",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({ids:this.selectedOrders,status:e})}).then(()=>location.reload())},async openOrderEdit(e){const t=await fetch(`/admin/orders/${e}`,{headers:{Accept:"application/json"}});if(!t.ok)return alert("Failed to load order");this.selectedOrder=await t.json(),this.openModal("order-edit")},updateOrder(){fetch(`/admin/orders/${this.selectedOrder.id}`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({status:this.selectedOrder.status,total:this.selectedOrder.total,shipping_address:this.selectedOrder.shipping_address,email:this.selectedOrder.email,phone:this.selectedOrder.phone})}).then(e=>{if(!e.ok)throw new Error("Update failed");this.closeModal("order-edit"),location.reload()}).catch(e=>{console.error(e),alert("Failed to save changes")})},async openReviewEdit(e){const t=await fetch(`/admin/reviews/${e}`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json"}});if(!t.ok)return alert("Failed to load review");this.selectedReview=await t.json(),this.openModal("review-edit")},updateReview(){fetch(`/admin/reviews/${this.selectedReview.id}`,{method:"PATCH",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({rating:this.selectedReview.rating,body:this.selectedReview.body,status:this.selectedReview.status})}).then(e=>{if(!e.ok)throw new Error("Save failed");this.closeModal("review-edit"),location.reload()}).catch(e=>{console.error(e),alert("Failed to save review")})}}}n.data("adminDashboard",g);n.start();window.Alpine=n;n.store("auth",{isAuthenticated:window.isAuthenticated});const m=parseFloat(document.querySelector('meta[name="tax-rate"]').content)||0;window.TAX_RATE=m;window.validateAndSubmit=e=>{var t;for(let r of e.querySelectorAll("[required]"))if(!String(r.value).trim()){let i=((t=e.querySelector(`label[for="${r.id}"]`))==null?void 0:t.innerText)||r.name;alert(`${i} is required.`),r.focus();return}e.submit()};document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("admin-filters-form");e&&e.addEventListener("submit",async t=>{t.preventDefault();const r=new URLSearchParams(new FormData(e)).toString(),i=`${e.action}?${r}`,o=await fetch(i,{headers:{"X-Requested-With":"XMLHttpRequest"}});if(!o.ok){console.error("Admin filter fetch failed",o);return}const a=await o.text(),s=new DOMParser().parseFromString(a,"text/html"),c=s.getElementById("admin-product-grid"),d=s.querySelector(".product-grid__pagination");c&&d&&(document.getElementById("admin-product-grid").replaceWith(c),document.querySelector(".product-grid__pagination").replaceWith(d),n.initTree(c),history.pushState(null,"",i))})});n.store("cart",{open:!1,toggle(){this.open=!this.open},close(){this.open=!1}});n.data("cartSidebar",()=>({loading:!1,items:[],subtotal:0,discount:0,tax:0,total:0,init(){this.$watch("$store.cart.open",e=>{e&&this.load()})},async load(){this.loading=!0;try{let e=await fetch("/cart",{headers:{Accept:"application/json"}});if(!e.ok)throw new Error(e.statusText);let t=await e.json();this.items=t.items.map(r=>({...r,price:parseFloat(r.price),quantity:parseInt(r.quantity,10)})),this.subtotal=this.items.reduce((r,i)=>r+i.price*i.quantity,0),this.discount=parseFloat(t.discount||0),this.tax=parseFloat(((this.subtotal-this.discount)*m).toFixed(2)),this.total=parseFloat((this.subtotal-this.discount+this.tax).toFixed(2))}catch(e){console.error("Cart load failed",e)}finally{this.loading=!1}},async remove(e){await fetch(`/cart/remove/${e}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content}}),this.load()}}));n.data("checkoutPage",()=>({stripe:null,elements:null,cardNumber:null,cardExpiry:null,cardCvc:null,clientSecret:null,step:1,items:[],subtotal:0,discount:0,tax:0,shippingFee:0,total:0,promoCode:"",promoError:"",orderError:"",loading:!1,shippingLoading:!1,shippingError:"",form:{name:"",email:"",phone:"",shipping_address:"",city:"",state:"",postal_code:"",country:""},init(){this.loadCart(),this.$watch("step",e=>{e===3&&this.initStripe()})},goToStep(e){var t;if(e===2){for(let r of["name","email","shipping_address","city","state","postal_code","country"])if(!((t=this.form[r])!=null&&t.trim())){alert(`Please enter your ${r.replace("_"," ")}`);return}this.calculateShipping()}else this.step=e},async loadCart(){const e=await fetch("/cart",{headers:{Accept:"application/json"}});if(!e.ok)return;const t=await e.json();this.items=t.items.map(r=>({...r,price:+r.price,quantity:+r.quantity})),this.subtotal=this.items.reduce((r,i)=>r+i.price*i.quantity,0),this.discount=+t.discount||0,this.shippingFee=0,this.recalc()},recalc(){this.tax=parseFloat(((this.subtotal-this.discount)*m).toFixed(2)),this.total=parseFloat((this.subtotal-this.discount+this.tax+this.shippingFee).toFixed(2))},async calculateShipping(){this.shippingError="",this.shippingLoading=!0;try{const e=await fetch("/checkout/shipping-cost",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify(this.form)}),t=await e.json();if(!e.ok)throw new Error(t.error||"Shipping calculation failed.");this.shippingFee=+t.shipping,this.recalc(),this.step=2}catch(e){this.shippingError=e.message}finally{this.shippingLoading=!1}},async applyPromo(){this.promoError="";const e=await fetch("/checkout/apply-promo",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({code:this.promoCode})}),t=await e.json();if(!e.ok){this.promoError=t.error;return}this.subtotal=+t.subtotal,this.discount=+t.discount,this.recalc()},async initStripe(){if(this.stripe)return;this.stripe=await A("pk_test_51RHTymPJuM73wkUGVIqqlmMGFBBPHMPNJB9MDqTEZF90F8X5oi0zBfRKr4dFg3RzTx35qn1b8NS4LHYzWNMORuWG00O20z85ko"),this.elements=this.stripe.elements();const e={base:{fontSize:"16px",color:"#333"}};this.cardNumber=this.elements.create("cardNumber",{style:e}),this.cardExpiry=this.elements.create("cardExpiry",{style:e}),this.cardCvc=this.elements.create("cardCvc",{style:e}),this.cardNumber.mount("#card-number"),this.cardExpiry.mount("#card-expiry"),this.cardCvc.mount("#card-cvc")},async pay(){this.orderError="",this.loading=!0;try{let e=await fetch("/checkout/payment-intent",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({shipping_address:this.form.shipping_address,email:this.form.email,phone:this.form.phone,shipping_fee:this.shippingFee})}),t=await e.json();if(!e.ok)throw new Error(t.error||"Payment initialization failed.");const r=t.clientSecret,{error:i,paymentIntent:o}=await this.stripe.confirmCardPayment(r,{payment_method:{card:this.cardNumber}});if(i)throw i;const a=await fetch("/checkout/place-order",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({...this.form,shipping_fee:this.shippingFee,payment_intent:o.id})}),s=await a.json();if(!a.ok)throw new Error(s.error||"Order placement failed.");window.location=s.checkout_url||"/checkout/success"}catch(e){this.orderError=e.message}finally{this.loading=!1}}}));n.data("adminDashboard",g);n.start();
